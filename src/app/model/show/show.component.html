<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item active">
            <a routerLink="/">{{"Home" | translate:locale.language}}</a>
        </li>
        <li class="breadcrumb-item">
            <a routerLink="/model">{{"Models" | translate:locale.language}}</a>
        </li>
        <li class="breadcrumb-item active" *ngIf="model">
            {{"Model" | translate:locale.language}}: {{model.name}}
        </li>
    </ol>
</nav>

<div class="container-fluid">
    <div class="row">
        <div class="col-md">
            <form class="form-inline">
                <div class="mx-1">
                    <h2>
                        <span class="fas fa-cube mx-1"></span>
                        <!--<span class="mx-1">{{"Model" | translate:locale.language}}: </span>-->
                        <span class="mx-1" *ngIf="!editName && model">{{model.name}}</span>
                    </h2>
                </div>
                <div class="form-group mx-1" *ngIf="editName && model">
                    <label for="modelName" class="sr-only">{{"ModelName" | translate:locale.language}}</label>
                    <input class="form-control" type="text" id="modelName"
                           #inputName [value]="model.name"
                           (change)="updateField(inputName, 'name')"/>
                </div>
                <div class="mx-1">
                    <small class="text-muted mx-1" *ngIf="model && model.imported_name">{{model.imported_name}}</small>
                </div>
                <div class="ml-1">
                    <button class="btn btn-sm text-secondary"
                            (click)="toggleField('name')">
                        <span class="fas fa-pencil-alt"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-md">
            <form class="form-inline">
                <div class="mx-1">
                    <span class="fas fa-user mr-1 ml-4 text-secondary"></span>
                    <!--<span class="mx-1 text-secondary">{{"Author" | translate:locale.language}}: </span>-->
                    <span class="mx-1 text-secondary" *ngIf="!editAuthor && model">{{model.author}}</span>
                </div>
                <div class="form-group mx-1" *ngIf="editAuthor && model">
                    <label for="modelAuthor" class="sr-only">{{"ModelAuthor" | translate:locale.language}}</label>
                    <input class="form-control form-control-sm" type="text" id="modelAuthor"
                           #inputAuthor [value]="model.author"
                           (change)="updateField(inputAuthor, 'author')"/>
                </div>
                <div class="mx-1">
                    <small class="text-muted mx-1"
                           *ngIf="model && model.imported_author">{{model.imported_author}}</small>
                </div>
                <div class="ml-1">
                    <button class="btn btn-xs text-secondary"
                            (click)="toggleField('author')">
                        <span class="fas fa-pencil-alt"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    <div class="row my-3" *ngIf="model">
        <div class="col-md-9 my-1">
            <div class="row">
                <div class="col-md">
                    <ng-container *ngFor='let fileType of ["image" , "model" , "diagram"]'>
                        <ng-container
                            *ngIf="viewableFilesMap.get(fileType) && viewableFilesMap.get(fileType).length > 0 && fileNavigation == fileType">
                            <ngb-carousel class="rounded" style="background-color: #e0e0e0; min-height: 50px;">
                                <ng-template ngbSlide
                                             *ngFor="let file of viewableFilesMap.get(fileType) | objectArraySort:'position':false">
                                    <div class="container w-100 d-flex align-items-center justify-content-center my-1">
                                        <ng-container
                                            [ngSwitch]="fileTypesService.getApplicationFromName(file.filename)">
                                            <img style="height: 50vh;" *ngSwitchCase="'image'"
                                                 [alt]="file.filename"
                                                 [src]="modelFilesService.getFileUrl(modelId, fileType, file.filename) | secure | async">
                                            <div *ngSwitchCase="'video'" style="height: 50vh;"
                                                 class="d-flex align-items-center justify-content-center">
                                                {{"VideosNotSupported" | translate:locale.language}}
                                            </div>
                                            <div *ngSwitchCase="'pdf'" style="height: 50vh;"
                                                 class="d-flex align-items-center justify-content-center">
                                                {{"PDFsNotSupported" | translate:locale.language}}
                                            </div>
                                            <!--
                                            <video style="height: 50vh;"
                                                [src]="modelFilesService.getFileUrl(modelId, fileNavigation, file.filename) | secure | async"
                                                *ngSwitchCase="'video'">
                                                {{"error.VideoDoesntWork" | translate:locale.language}}
                                            </video>
                                            Doesn't work with auth - need to build token URL into backend
                                            -->
                                            <!--
                                            <div *ngSwitchCase="'pdf'">
                                                Jo
                                                <pdf-viewer style="height: 50vh;"
                                                            [src]="x">
                                                </pdf-viewer>
                                            </div>
                                            Doesn't work within ngSwitch (doesn't request file)
                                            -->
                                            <div *ngSwitchDefault style="height: 50vh;">
                                                {{"error.Unknown" | translate:locale.language}}
                                            </div>
                                        </ng-container>
                                    </div>
                                </ng-template>
                            </ngb-carousel>
                        </ng-container>
                    </ng-container>
                    <div class="container w-100 d-flex align-items-center justify-content-center my-1"
                         *ngIf="!viewableFilesMap.get(fileNavigation) || viewableFilesMap.get(fileNavigation).length == 0">
                        {{"NoFiles" | translate:locale.language}}
                    </div>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-md">
                    <div class="btn-group btn-group-sm w-100">
                        <button class="btn btn-outline-primary"
                                *ngIf="viewableFilesMap.get('image') && viewableFilesMap.get('image').length > 0"
                                [class.active]="fileNavigation == 'image'"
                                (click)="fileNavigation = 'image'">
                            {{"Images" | translate:locale.language}}
                        </button>
                        <button class="btn btn-outline-primary"
                                *ngIf="viewableFilesMap.get('model') && viewableFilesMap.get('model').length > 0"
                                [class.active]="fileNavigation == 'model'"
                                (click)="fileNavigation = 'model'">
                            {{"Models" | translate:locale.language}}
                        </button>
                        <button class="btn btn-outline-primary"
                                *ngIf="viewableFilesMap.get('diagram') && viewableFilesMap.get('diagram').length > 0"
                                [class.active]="fileNavigation == 'diagram'"
                                (click)="fileNavigation = 'diagram'">
                            {{"Diagrams" | translate:locale.language}}
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 my-1">
            <div class="list-group">
                <button class="list-group-item list-group-item-action"
                        (click)="uploadMode = !uploadMode"
                        [class.active]="uploadMode">
                    <span class="fas fa-upload mr-2"
                          [class.text-primary]="!uploadMode"
                          [class.text-white]="uploadMode"></span>
                    {{"Upload" | translate:locale.language}}
                </button>
                <button class="list-group-item list-group-item-action"
                        *ngIf="!uploadMode"
                        [class.active]="model.favorite"
                        (click)="changeFavorite()">
                    <span class="fa-heart mr-2"
                          [class.far]="!model.favorite" [class.fas]="model.favorite"
                          [class.text-primary]="!model.favorite" [class.text-white]="model.favorite"
                          [class.bg-primary]="model.favorite"></span>
                    {{"Favorite" | translate:locale.language}}
                </button>
                <div class="list-group-item list-group-item-action" *ngIf="!uploadMode">
                    <app-tags-element [modelId]="modelId"></app-tags-element>
                </div>
                <div class="list-group-item list-group-item-action p-1" *ngIf="uploadMode">
                    <app-upload-element [modelId]="modelId"></app-upload-element>
                </div>
            </div>
        </div>
    </div>
    <div class="row my-3">
        <div class="col-md-3 my-1">
            <div class="list-group">
                <button class="list-group-item list-group-item-action"
                        [class.active]="navigation === 'description'"
                        (click)="navigation = 'description'">
                    <span class="fas fa-edit text-primary mr-2"
                          [class.text-primary]="navigation !== 'description'"
                          [class.text-white]="navigation === 'description'"></span>
                    {{"Description" | translate:locale.language}}
                </button>
                <button class="list-group-item list-group-item-action"
                        [class.active]="navigation === 'import_description'"
                        (click)="navigation = 'import_description'"
                        *ngIf="model && model.imported_description">
                    <span class="far fa-edit text-primary mr-2"
                          [class.text-primary]="navigation !== 'import_description'"
                          [class.text-white]="navigation === 'import_description'"></span>
                    {{"ImportedDescription" | translate:locale.language}}
                </button>
                <button class="list-group-item list-group-item-action"
                        [class.active]="navigation === 'notes'"
                        (click)="navigation = 'notes'">
                    <span class="fas fa-sticky-note text-primary mr-2"
                          [class.text-primary]="navigation !== 'notes'"
                          [class.text-white]="navigation === 'notes'"></span>
                    {{"Notes" | translate:locale.language}}
                </button>
                <button class="list-group-item list-group-item-action"
                        [class.active]="navigation === 'links'"
                        (click)="navigation = 'links'">
                    <span class="fas fa-link text-primary mr-2"
                          [class.text-primary]="navigation !== 'links'"
                          [class.text-white]="navigation === 'links'"></span>
                    {{"Links" | translate:locale.language}}
                </button>
            </div>
        </div>
        <div class="col-md-9 my-1" *ngIf="model">
            <div class="border border-secondary rounded p-2">
                <div class="row"
                     *ngIf="navigation == 'description' || navigation == 'notes'">
                    <div class="col-md text-right">
                        <small class="text-muted mr-2" #saved></small>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-success" (click)="saveText($event)"
                                    *ngIf="editMode != 'onlyView'">
                                <span class="fas fa-save"></span>
                            </button>
                            <button class="btn btn-outline-secondary" (click)="switchEditMode()">
                                <span class="fas fa-pencil-alt"></span>
                            </button>
                        </div>
                    </div>
                </div>
                <ng-container [ngSwitch]="navigation">
                    <ng-container *ngSwitchDefault>
                        <div class="row mx-0 mb-3 mt-2">
                            <div *ngIf="editMode != 'onlyView'"
                                 [class.col-md-6]="editMode == 'splitView'"
                                 [class.col-md]="editMode == 'onlyEdit'">
                                <label for="modelDescription" class="sr-only">Edit description</label>
                                <textarea id="modelDescription" [(ngModel)]="model.description"
                                          autosize [minRows]="10"
                                          (change)="saveText($event)"
                                          class="form-control text-monospace small"></textarea>
                            </div>
                            <div *ngIf="editMode != 'onlyEdit'"
                                 [class.col-md-6]="editMode == 'splitView'"
                                 [class.col-md]="editMode == 'onlyView'">
                                <markdown [data]="model.description" emoji katex lineNumbers
                                          class="h-100"></markdown>
                            </div>
                        </div>
                    </ng-container>
                    <div *ngSwitchCase="'import_description'" [innerHTML]="model.imported_description"></div>
                    <div *ngSwitchCase="'notes'">
                        <div class="row mx-0 mb-3 mt-2">
                            <div *ngIf="editMode != 'onlyView'"
                                 [class.col-md-6]="editMode == 'splitView'"
                                 [class.col-md]="editMode == 'onlyEdit'">
                                <label for="modelNotes" class="sr-only">Edit notes</label>
                                <textarea id="modelNotes" [(ngModel)]="model.notes"
                                          autosize [minRows]="10"
                                          (change)="saveText($event)"
                                          class="form-control text-monospace small"></textarea>
                            </div>
                            <div *ngIf="editMode != 'onlyEdit'"
                                 [class.col-md-6]="editMode == 'splitView'"
                                 [class.col-md]="editMode == 'onlyView'">
                                <markdown [data]="model.notes" emoji katex lineNumbers
                                          class="h-100"></markdown>
                            </div>
                        </div>
                    </div>
                    <div *ngSwitchCase="'links'" class="m-3">
                        <app-links-element [model]="model"></app-links-element>
                    </div>
                </ng-container>
            </div>
        </div>
    </div>
</div>